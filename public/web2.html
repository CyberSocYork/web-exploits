<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" type="text/css" href="styles.css" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;700&display=swap"
			rel="stylesheet"
		/>
		<title>CyberSoc Store!</title>
	</head>
	<body>
		<h1>CyberSoc Store!</h1>
		<p>
			Search our amazing store!
		</p>

		<form id="ping-form">
			<label for="item">Search</label>
			<input
				type="text"
				name="item"
				placeholder="Item"
				autocomplete="off"
			/>
			<button type="submit">Submit</button>
		</form>
		<table id="resultsTable">
			<tr>
				<th>ID</th>
				<th>Name</th>
				<th>Description</th>
				<th>Price</th>
			</tr>
		</table>
		<script>
			function handleSubmit(e) {
				e.preventDefault();

				const responseTable = document.getElementById("resultsTable");
				const formData = new FormData(e.target);

				fetch("./api2", {
					method: "post",
					headers: {
						"Content-Type":
							"application/x-www-form-urlencoded;charset=UTF-8",
					},
					body: new URLSearchParams(formData).toString(),
				})
					.then((res) => res.text())
					.then((res) => {
						for (var i = responseTable.rows.length; i > 1; i--) {
					            responseTable.deleteRow(i - 1);
					        }	
						res = JSON.parse(res);						
						for (let item of res) {
							var row = responseTable.insertRow();
							for (let value of Object.values(item)) {
								var cell = row.insertCell();
								cell.innerHTML = value;
							}
						}
					});

				return false; // prevents default form behaviour
			}

			const loginForm = document.getElementById("ping-form");
			loginForm.addEventListener("submit", handleSubmit);
		</script>
	</body>
</html>
