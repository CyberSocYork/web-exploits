"use strict";
const express = require("express");
const path = require("path");

const { exec } = require("child_process");

const app = express();

const PORT = process.env.PORT || 3000;

const pagesDir = path.join(__dirname, "public/");

app.use(
	express.static(path.join(__dirname, "public")),
	express.urlencoded({ extended: true })
);

app.get("/", (_, res) => {
	return res.sendFile(path.join(pagesDir, "form.html"));
});

app.post("/api", (req, res) => {
	const ipAddress = req.body.ipaddress;

	exec(`runuser -l web_user -c '/bin/rbash -r -c "ping -c 1 ${ipAddress}"'`, 
	(err, stdout, stderr) => {
		if (err) {
			return res.send(stderr);
		} else {
			return res.send(stdout);
		}
	});
});

app.listen(3000);
console.log(`Listening on port ${PORT}`);
